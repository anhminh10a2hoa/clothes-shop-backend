require('dotenv').config();
import express from 'express';
import cors from 'cors';
import { createConnection } from 'typeorm';
import productRouter from './routes/productRouter';
import generateData from './utils/autoGenerateData';
import fileUpload from "express-fileupload";
import bodyParser from  "body-parser";

const port = 3000;

const main = async () => {
  await createConnection()

  const app = express();
  app.use(cors())
  app.use(express.json())
  app.use(bodyParser.json({limit: '50mb'}));
  app.use(bodyParser.urlencoded({limit: '50mb', extended: false }));
  app.use(fileUpload({
    limits: { fileSize: 50 * 1024 * 1024 },
  }));

  generateData();

  app.get('/', (_, res) => {
    res.send('Hello World!');
  });

  app.use('/api/v1/products', productRouter);
  
  app.listen(port, () => {
    return console.log(`Express is listening at http://localhost:${port}`);
  });
}

main().catch(err => console.log(err));